TASK: Extract ALL UI creation, visual systems, and highlight management into comprehensive UIManager module

OBJECTIVE: Create UIManager.lua that handles:
1. All UI element creation (all create*() functions)
2. Highlight systems (inventory, chest, storage)
3. Selection visuals
4. Item frame creation with rarity colors
5. Modal/popup systems
6. Viewport character display

TARGET FILE: UIManager.lua
ESTIMATED SIZE: ~800-1000 lines

SOURCE CODE SECTIONS TO EXTRACT:

SECTION 1: BASE UI CREATION
Lines: 170-190 (createBaseUI)
Lines: 192-235 (createInventoryButton)
Lines: 240-270 (createMainPanel)

SECTION 2: ACTION BAR & MODALS
Lines: 275-350 (createActionBar)
Lines: 352-520 (createItemInfoModal + showItemInfoModal + hideItemInfoModal)

SECTION 3: CONTENT CONTAINERS
Lines: 530-560 (createContentScroll)
Lines: 562-625 (createRigContainer with grid slots creation)
Lines: 627-670 (createBackpackContainer)
Lines: 672-695 (createLootInfoContainer)

SECTION 4: ARMOR SYSTEM UI
Lines: 710-850 (createArmorContainer with all armor slots + click handlers)

SECTION 5: PLAYER & CHEST CONTAINERS
Lines: 865-980 (createPlayerAndChestContainers including chest grid)
Lines: 982-1080 (recreateChestGrid - dynamic chest grid creation)

SECTION 6: CHARACTER VIEWPORT
Lines: 1095-1180 (createCharacterViewport + rotation handlers)
Lines: 1182-1235 (updateCharacterViewport - static character display)

SECTION 7: STATUS CONTAINER
Lines: 1240-1310 (createStatusContainer with health bar)
Lines: 1312-1340 (updateHealthBar + connectHealthBar)

SECTION 8: ITEM VISUAL CREATION
Lines: ~1350-1450 (createItemFrame with rarity colors, gradients, icons)

SECTION 9: HIGHLIGHT SYSTEMS - INVENTORY
Lines: ~1470-1520 (clearHighlights, highlightSlots)
Lines: ~1522-1580 (highlightOriginalSlot, resetOriginalSlotHighlight)

SECTION 10: HIGHLIGHT SYSTEMS - CHEST
Lines: ~1590-1640 (clearChestHighlights, highlightChestSlots)
Lines: ~1642-1700 (highlightChestOriginalSlot, resetChestOriginalSlotHighlight)

SECTION 11: HIGHLIGHT SYSTEMS - STORAGE
Lines: ~1710-1760 (clearStorageHighlights, highlightStorageSlots)
Lines: ~1762-1820 (highlightStorageOriginalSlot, resetStorageOriginalSlotHighlight)

SECTION 12: ITEM INFO POPUP SYSTEM
Lines: ~1830-1940 (closeItemInfoPopup, showItemInfoPopup with long-press logic)

⚠️⚠️⚠️ CRITICAL PRESERVATION RULES ⚠️⚠️⚠️

1. ZINDEX VALUES - NEVER CHANGE:
   - Panel ZIndex = 10
   - Grid elements = 10-16
   - Items = 15-16
   - Action bar = 20-21
   - Highlights = 12-14
   - Modals = 150-152
   - Popups = 100-102
   ANY CHANGE BREAKS LAYERING!

2. COLOR VALUES - PRESERVE EXACTLY:
   - ALL Color3.fromRGB() values must match original
   - Rarity colors from ItemConfig.GetRarityColor()
   - Gradient ColorSequence keypoints identical

3. POSITION/SIZE - DO NOT MODIFY:
   - ALL UDim2.new() values must be exact
   - Anchor points must match
   - Padding/spacing values preserved

4. PARENT HIERARCHY - CRITICAL:
   - Parent relationships define rendering order
   - ClipsDescendants behavior depends on hierarchy
   - Touch input routing depends on hierarchy

5. VIEWPORT ROTATION LOGIC - PRESERVE:
   Lines 1130-1170: Input handling sequence
   - InputBegan → InputChanged → InputEnded chain
   - Mouse/Touch ID tracking
   - Rotation sensitivity (delta * 0.5)
   - CFrame calculation exact

6. GRID SLOT CREATION - EXACT LOOPS:
   Lines 595-615: Grid slot creation loops
   - Row/col iteration order matters
   - Position calculation formula critical
   - Slot naming convention matters for later access

7. RARITY VISUAL SYSTEM:
   Lines 1380-1420: Item frame with rarity
   - Uses ItemConfig.GetRarityFrameColor()
   - Uses ItemConfig.GetRarityColor() for stroke
   - Gradient calculation based on frame color
   - Transparency from ItemConfig.GetRarityFrameTransparency()

FUNCTION ORGANIZATION:

```lua
-- UIManager.lua structure (NO FULL CODE, just organization):

local UIManager = {}

-- Dependencies
local StateAndDataManager = require(...)
local Services = {...}

-- UI References (will be populated)
UIManager.UI = {}

-- ============================================================================
-- SECTION 1: BASE UI CREATION (~100 lines)
-- ============================================================================
function UIManager.createBaseUI(playerGui)
    -- Lines 170-190 logic
    -- Returns: screenGui, uiScale
end

function UIManager.createInventoryButton(parent)
    -- Lines 192-235 logic
    -- Returns: invButton, touchBlocker
end

function UIManager.createMainPanel(parent)
    -- Lines 240-270 logic
    -- Returns: mainPanel, closeButton, panelScale
end

-- ============================================================================
-- SECTION 2: ACTION BAR & MODALS (~150 lines)
-- ============================================================================
function UIManager.createActionBar(parent)
    -- Lines 275-350 logic
    -- Create action bar with info/drop buttons
    -- Returns: actionBar, infoButton, dropButton, actionItemIcon, etc
end

function UIManager.createItemInfoModal(parent)
    -- Lines 352-450 logic
    -- Create modal with icon, labels, description
    -- Returns: modal UI elements
end

function UIManager.showItemInfoModal(itemData)
    -- Lines 452-490 logic
    -- Update modal content and show
end

function UIManager.hideItemInfoModal()
    -- Lines 492-496 logic
end

function UIManager.updateActionBar(itemData)
    -- Lines 498-520 logic
    -- Update action bar with selected item
end

-- ============================================================================
-- SECTION 3: CONTENT CONTAINERS (~200 lines)
-- ============================================================================
function UIManager.createContentScroll(parent)
    -- Lines 530-560 logic
    -- Scrolling frame with layout
    -- Returns: contentScroll
end

function UIManager.createRigContainer(parent, stateAndDataManager)
    -- Lines 562-625 logic
    -- CRITICAL: Grid slot creation with exact positioning
    -- Populate Data.gridSlots table
    -- Returns: rigContainer, gridContainer
end

function UIManager.createBackpackContainer(parent)
    -- Lines 627-670 logic
    -- Returns: backpackContainer
end

function UIManager.createLootInfoContainer(parent)
    -- Lines 672-695 logic
    -- Returns: lootInfoContainer, equipmentValueLabel, weightLabel
end

-- ============================================================================
-- SECTION 4: ARMOR SYSTEM UI (~150 lines)
-- ============================================================================
function UIManager.createArmorContainer(parent, stateAndDataManager, remoteEvents, canFitItemAnywhereFunc)
    -- Lines 710-850 logic
    -- CRITICAL: Armor slot click handlers
    -- Equipment/unequipment logic
    -- Space checking before unequip
    -- Populate Data.armorSlots table
    -- Returns: armorContainer
end

-- ============================================================================
-- SECTION 5: CHEST & PLAYER CONTAINERS (~120 lines)
-- ============================================================================
function UIManager.createPlayerAndChestContainers(parent)
    -- Lines 865-980 logic
    -- PlayerContainer with viewport
    -- ChestContainer with dynamic grid
    -- Opening overlay with progress bar
    -- Returns: PlayerContainer, ChestContainer, chestNameLabel, gridContainerChest, etc
end

function UIManager.recreateChestGrid(stateAndDataManager, setupChestSlotInputFunc)
    -- Lines 982-1080 logic
    -- CRITICAL: Dynamic grid recreation based on chest config
    -- Only recreate if size changed
    -- Setup input handlers for each slot
end

-- ============================================================================
-- SECTION 6: CHARACTER VIEWPORT (~150 lines)
-- ============================================================================
function UIManager.createCharacterViewport(parent, stateAndDataManager)
    -- Lines 1095-1180 logic
    -- CRITICAL: Rotation input handlers
    -- InputBegan/Changed/Ended chain
    -- Touch ID tracking
    -- Returns: viewportFrame, worldModel, viewportCamera
end

function UIManager.updateCharacterViewport(player, stateAndDataManager)
    -- Lines 1182-1235 logic
    -- Clone character for static display
    -- Clean up scripts/humanoid
    -- Load idle animation ONLY
    -- Position camera
end

-- ============================================================================
-- SECTION 7: STATUS & HEALTH (~100 lines)
-- ============================================================================
function UIManager.createStatusContainer(parent)
    -- Lines 1240-1310 logic
    -- Health bar with divider
    -- Returns: statusContainer, healthBarFill, healthLabel
end

function UIManager.updateHealthBar(player)
    -- Lines 1312-1330 logic
    -- Update bar size and color based on health
end

function UIManager.connectHealthBar(player, stateAndDataManager)
    -- Lines 1332-1340 logic
    -- Connect to humanoid health changes
end

-- ============================================================================
-- SECTION 8: ITEM VISUALS (~100 lines)
-- ============================================================================
function UIManager.createItemFrame(itemConfig, width, height, row, col, stateAndDataManager)
    -- Lines ~1350-1450 logic
    -- CRITICAL: Rarity color system
    -- Frame background from GetRarityFrameColor()
    -- Stroke from GetRarityColor()
    -- Gradient calculation
    -- Icon setup (ImageLabel or fallback Frame)
    -- Returns: itemFrame
end

-- ============================================================================
-- SECTION 9: HIGHLIGHT SYSTEM - INVENTORY (~110 lines)
-- ============================================================================
function UIManager.clearHighlights(stateAndDataManager)
    -- Lines ~1470-1480 logic
end

function UIManager.highlightSlots(startRow, startCol, width, height, isValid, stateAndDataManager)
    -- Lines ~1482-1520 logic
    -- CRITICAL: Green (valid) vs Red (invalid)
    -- Position calculation with CELL_SIZE + CELL_PADDING
    -- ZIndex = 14 (above slots, below items)
end

function UIManager.highlightOriginalSlot(row, col, width, height, stateAndDataManager)
    -- Lines ~1522-1560 logic
    -- Yellow overlay for original position
    -- ZIndex = 12
end

function UIManager.resetOriginalSlotHighlight(stateAndDataManager)
    -- Lines ~1562-1580 logic
end

-- ============================================================================
-- SECTION 10: HIGHLIGHT SYSTEM - CHEST (~110 lines)
-- ============================================================================
function UIManager.clearChestHighlights(stateAndDataManager)
    -- Lines ~1590-1600 logic
end

function UIManager.highlightChestSlots(startRow, startCol, width, height, isValid, stateAndDataManager)
    -- Lines ~1602-1640 logic
    -- Use CHEST.CELL_SIZE and CHEST.CELL_PADDING
    -- Parent to gridContainerChest
end

function UIManager.highlightChestOriginalSlot(row, col, width, height, stateAndDataManager)
    -- Lines ~1642-1680 logic
end

function UIManager.resetChestOriginalSlotHighlight(stateAndDataManager)
    -- Lines ~1682-1700 logic
end

-- ============================================================================
-- SECTION 11: HIGHLIGHT SYSTEM - STORAGE (~110 lines)
-- ============================================================================
function UIManager.clearStorageHighlights(stateAndDataManager)
    -- Lines ~1710-1720 logic
end

function UIManager.highlightStorageSlots(startRow, startCol, width, height, isValid, stateAndDataManager)
    -- Lines ~1722-1760 logic
    -- Use STORAGE.CELL_SIZE and STORAGE.CELL_PADDING
end

function UIManager.highlightStorageOriginalSlot(row, col, width, height, stateAndDataManager)
    -- Lines ~1762-1800 logic
end

function UIManager.resetStorageOriginalSlotHighlight(stateAndDataManager)
    -- Lines ~1802-1820 logic
end

-- ============================================================================
-- SECTION 12: ITEM INFO POPUP (~130 lines)
-- ============================================================================
function UIManager.closeItemInfoPopup(stateAndDataManager)
    -- Lines ~1830-1840 logic
end

function UIManager.showItemInfoPopup(itemData, stateAndDataManager)
    -- Lines ~1842-1940 logic
    -- CRITICAL: Position calculation relative to mainPanel
    -- Avoid ClipsDescendants by parenting to mainPanel
    -- Rarity color system for icon frame
    -- Icon, name, weight, description layout
end

-- ============================================================================
-- INITIALIZATION
-- ============================================================================
function UIManager.initialize(player, stateAndDataManager, remoteEvents)
    -- Call all create*() functions in correct order
    -- Wire up all UI references to UIManager.UI table
    -- Connect button click handlers
    -- Setup input handlers
    -- Return UIManager
end

return UIManager
⚠️⚠️⚠️ VALIDATION CHECKLIST ⚠️⚠️⚠️
UI VISUAL TESTS:
✅ All UI elements appear in correct positions
✅ ZIndex layering correct (no elements behind when should be front)
✅ Colors match original exactly
✅ Gradients render correctly
✅ Rarity colors display properly (Common=gray, Rare=blue, Epic=purple, Legendary=gold)
INTERACTION TESTS:
✅ Inventory button toggles panel
✅ Close button works
✅ Action bar shows/hides correctly
✅ Info modal opens with correct data
✅ Viewport character rotates with mouse/touch
✅ Health bar updates correctly
HIGHLIGHT TESTS:
✅ Green highlight for valid placement
✅ Red highlight for invalid placement
✅ Yellow highlight for original position
✅ Highlights clear properly
✅ Chest/storage highlights work independently
RESPONSIVE TESTS:
✅ UIScale updates on viewport size change
✅ Touch blocker prevents camera movement on mobile
✅ Scrolling works in content scroll
GRID SLOT TESTS:
✅ All grid slots created in correct positions
✅ Data.gridSlots populated correctly
✅ Chest grid recreates with different sizes
✅ Storage grid renders properly
ARMOR SYSTEM TESTS:
✅ Armor slots clickable
✅ Equipment visual feedback works
✅ Unequip checks inventory space
✅ Stroke color changes on equip (green)
CHARACTER VIEWPORT TESTS:
✅ Character clones correctly
✅ Idle animation plays
✅ Rotation smooth with input
✅ Camera positioned correctly
MODAL TESTS:
✅ Item info modal shows correct data
✅ Modal close button works
✅ Modal positioned correctly (not clipped)
INTEGRATION NOTES:
Replace in original script:
All UI. references → UIManager.UI.
All create*() calls → UIManager.create*()
All highlight functions → UIManager.highlight*()
Pass stateAndDataManager to all functions that need State/Data/Config
Example usage:
local UIManager = require(script.UIManager)
local StateAndDataManager = require(script.StateAndDataManager)

-- Initialize UI
UIManager.initialize(player, StateAndDataManager, remoteEvents)

-- Access UI elements
UIManager.UI.mainPanel.Visible = true

-- Highlight slots
UIManager.highlightSlots(1, 1, 2, 2, true, StateAndDataManager)

-- Create item frame
local itemFrame = UIManager.createItemFrame(itemConfig, 2, 2, 1, 1, StateAndDataManager)
ROLLBACK PLAN:
If UI breaks:
Check ZIndex values first (most common issue)
Verify Color3 values match exactly
Check parent hierarchy
Test each section independently
Use original create*() functions as reference
DO NOT PROCEED TO PROMPT 3 UNTIL:
✅ ALL UI elements visible and positioned correctly
✅ ALL interactions work (buttons, rotation, highlights)
✅ Rarity colors display properly
✅ No visual glitches
✅ Health bar updates
✅ Viewport character displays and rotates